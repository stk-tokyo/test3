<!DOCTYPE html>
<html lang="ja">
<head>
  <title>避難アンケート</title>
  <meta charset="UTF-8">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <script type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

  <div id="header"><h1>津波からの避難に関するアンケート</h1></div>
	
	
  <form id="path" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSeAfoJ_AGvIfQCIs4x9AHZt6Bu31lkmmjo4NsU_UrfIS7XDOQ/formResponse" method="POST" style="width:80%; position:relative;top:20px;">
    <ul id="question">
     <li> 
       <label class="q">
         問１：あなたの世帯の現住所を教えてください。
         <input type="text" name="entry.1763673255">
       </label>
     </li>
  
     <li> 
       <label class="q">
         問２：あなたと世帯主との続柄について教えてください。世帯主とは、あなたの世帯で最も収入の多い人のことです。
         <select id="relation" name="entry.1205779165" required>
     	   <option disabled selected>選択してください</option>
     	   <option value="世帯主本人">世帯主本人</option>
     	   <option value="夫・妻">夫・妻</option>
     	   <option value="父・母">父・母</option>
     	   <option value="兄弟・姉妹">兄弟・姉妹</option>
     	   <option value="子ども">子ども</option>
	   <option value="祖父母">祖父母</option>
	   <option value="孫">孫</option>
	   <option value="その他">その他</option>
         </select>
       </label>
     </li>
	 
     <li> 
       <label class="q">問３：あなたの性別を教えてください。</label>
	 <label><input type="radio" name="entry.667348671" value="男">男</label>
	 <label><input type="radio" name="entry.667348671" value="女">女</label>
   　　　 <label><input type="radio" name="entry.667348671" value="その他">その他</label>
     </li>

     <li>	 
       <label class="q">
         問４：あなたの年齢を教えてください。
         <input type="text" name="entry.1926174947">
       </label>
     </li>

     <li>	 
       <label class="q">
	 問５：あなたの職業について以下の中から選択してください。
         <select id="occupation" name="entry.1962891009" required>
     	   <option disabled selected>選択してください</option>
     	   <option value="会社員（正社員）">会社員（正社員）</option>
     	   <option value="会社員（契約社員）">会社員（契約社員）</option>
     	   <option value="公務員">公務員</option>
     	   <option value="自営業">自営業</option>
     	   <option value="農業・漁業関係者">農業・漁業関係者</option>
	   <option value="会社役員・経営者">会社役員・経営者</option>
	   <option value="専業主婦・主夫">専業主婦・主夫</option>
	   <option value="パート・アルバイト">パート・アルバイト</option>
	   <option value="学生（大学・高専・専門学校）">学生（大学・高専・専門学校）</option>
	   <option value="学生（小・中・高校生）">学生（小・中・高校生）</option>
	   <option value="無職">無職</option>
	   <option value="その他">その他</option>
        </select>
       </label>
     </li>
	 
     <li>	 
   　　 <label class="q">問６：次の役職・職業に該当する方は当てはまるものを全て選択してください。</label>
   　　   <label>
      　　  <input class="checkbox form-check-input" type="checkbox" name="entry.1591379079" value="消防団員">消防団員
　　　　   </label>
　　　　   <label>
      　　  <input class="checkbox form-check-input" type="checkbox" name="entry.1591379079" value="学校職員">学校職員
　　　　   </label>
　　　　   <label>
      　　  <input class="checkbox form-check-input" type="checkbox" name="entry.1591379079" value="自治会役員">自治会役員
　　　　   </label>
　　　　   <label>
      　　  <input class="checkbox form-check-input" type="checkbox" name="entry.1591379079" value="福祉施設職員">福祉施設職員
　　　　   </label>
     </li>
	 
     <li>	 
       <label class="q">問７：あなたは避難するに当たって、他の人の助けを必要としていますか。助けを必要とする場合はその理由を選択してください。</label>
　　　　  <label><input type="radio" name="entry.198548713" value="助けは必要ない。">助けは必要ない。</label>
　　　　  <label><input type="radio" name="entry.198548713" value="要支援認定を受けており、助けが必要。">要支援認定を受けており、助けが必要。</label>
　　　　  <label><input type="radio" name="entry.198548713" value="要介護認定を受けており、助けが必要。">要介護認定を受けており、助けが必要。</label>
　　　　  <label><input type="radio" name="entry.198548713" value="障がい者認定を受けており、助けが必要。">障がい者認定を受けており、助けが必要。</label>
     　  <label>その他（具体的にご記入ください。）
       　  <input type="text" name="entry.1862976019">
     　  </label>
     </li>	  
  	  
     <li>	   
       <label class="q">問８：あなたの職場または学校などの位置を教えてください。職場・学校などの名称、または住所を番地までご記入ください。</label>
         <label>名称
           <input type="text" name="entry.632425157">
         </label>
         <label>住所
           <input type="text" name="entry.849395908">
         </label> 	     
     </li>　　
	
     <li>
       <label class="q">問９：あなたの平日の平均的な行動を下の表にご記入ください。</label>
         <table border="1">
　　　　    <tr>
    　　　    <th>時刻</th>
	     <th>行動</th>
	     <th>誰と</th>
	     <th>場所</th>
　　　　    </tr>
	  
           <tr>
             <td><input type="time" name="entry.276627774" step="600"></td>
	     <td>
	       <select id="action" name="entry.219809398" required>
     	         <option disabled selected>選択してください</option>
     	         <option value="起床">起床</option>
     	         <option value="食事">食事</option>
     	         <option value="出勤・登校">出勤・登校</option>
     	         <option value="買い物">買い物</option>
     	         <option value="送迎">送迎</option>
	         <option value="娯楽">娯楽</option>
	         <option value="帰宅">帰宅</option>
	         <option value="就寝">就寝</option>
               </select>
	     </td>
	     <td>
	       <label><input type="radio" name="entry.1568708261" value="家族・親族">家族・親族</label>
	       <label><input type="radio" name="entry.1568708261" value="友人">友人</label>
	       <label>その他</label><input type="text" name="entry.1568708261">
	     </td>
	     <td><input type="text" name="entry.2086656375"></td>
           </tr>
	  
           <tr>
             <td><input type="time" name="entry.30834516" step="600"></td>
	     <td>
	       <select id="action" name="entry.1138177677" required>
     	         <option disabled selected>選択してください</option>
     	         <option value="起床">起床</option>
     	         <option value="食事">食事</option>
     	         <option value="出勤・登校">出勤・登校</option>
     	         <option value="買い物">買い物</option>
     	         <option value="送迎">送迎</option>
	         <option value="娯楽">娯楽</option>
	         <option value="帰宅">帰宅</option>
	         <option value="就寝">就寝</option>
               </select>
	     </td>
	     <td>
	       <label><input type="radio" name="entry.480557137" value="家族・親族">家族・親族</label>
	       <label><input type="radio" name="entry.480557137" value="友人">友人</label>
	       <label>その他</label><input type="text" name="entry.480557137">
	     </td>
	     <td><input type="text" name="entry.1330683577"></td>
           </tr>
         </table>
     </li>
	 
     <li>	 
       <label>以下の地図上をクリックして、避難経路に沿ってピンを立ててください.</label>
       <input type="text" name="entry.1323365906" value="選択されていません" required/>
     </li>
    </ul>
    <button type="submit">回答を送信</button>
  </form>
	
  <div id="area-selection">	
    <form>  <!--style="position:relative; top:50px;"-->
      <select id="place">  <!--style="width:200px; height:52px;"-->
        <option value="">地域を選択してください</option>
        <option value="yawatahama">八幡浜市街</option>
        <option value="minatoura">湊浦</option>
        <option value="sionasi">塩成</option>
      </select>
      <input type="button" value="決定" onclick="calcBmi();">  <!--style="width:200px; height:52px; position:relative;"-->
      <!-- <input type="button" value="やり直す" onclick="calcBmi();">  -->
    </form>
  </div>
	
  <div id="map"></div>　<!--style="position:relative;height:80%; width:80%; top:70px; left:20px;"-->

  <div id="area-result">
    <ul>  <!--style="position:relative; top:90px;"-->
      <li><b>ポイント数: </b><span id="cnt"></span></li>
      <li><b>緯度: </b><span id="lat"></span></li>
      <li><b>経度: </b><span id="lng"></span></li>
    </ul>

    <input type="button" value="避難経路を保存" onclick="save();">  <!--style="width:200px; height:52px; position:relative; top:120px;"-->
  </div>


 <script>
  var array0 = [['marker','latitude','longitude']];
  var table  = array0;

  // 場所選択時における画面遷移
  function move(st_lat,st_lng) {
  // マップの初期化
    var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 17,
    center: {lat: st_lat, lng: st_lng},
    clickableIcons: false,
    });
    // クリックイベントを追加
    map.addListener('click', function(e) {
      getClickLatLng(e.latLng, map);
    });
  }

  function calcBmi(){
	var place = document.getElementById('place').value;
	if(place == 'yawatahama'){
	   move(33.462899,132.423363);
        }else if(place=='minatoura'){
           move(33.488573,132.354165);   
	}else if(place=='sionasi'){
           move(33.443015,132.258223); 
        }
  }


    var click_count = 0;
   
    function initMap() {
      // マップの初期化
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 17,
        center: {lat:33.462899, lng: 132.423363},
	clickableIcons: false,
      });

      // クリックイベントを追加
      map.addListener('click', function(e) {
        getClickLatLng(e.latLng, map);
      });
    }

    function getClickLatLng(lat_lng, map) {
      click_count++;
      str_cnt = String(click_count);
      str_lat = String(lat_lng.lat());
      str_lng = String(lat_lng.lng());
      var array1 = [str_cnt, str_lat, str_lng];
      array0.push(array1);
      // 座標を表示
      document.getElementById('lat').textContent = lat_lng.lat();
      document.getElementById('lng').textContent = lat_lng.lng();
      document.getElementById('cnt').textContent = click_count;
  

      // マーカーを設置
      var marker = new google.maps.Marker({
        position: lat_lng,
        map: map,
	title: str_cnt,
	label: {
	  text: str_cnt,
	  color: "white",
	},
      });

      var size = new google.maps.Size( 200, 200 ) ;

      // 座標の中心をずらす
           map.panTo(lat_lng);
    }


    // 配列を文字列に変換するための関数
  function tableToCsvString(table) {
          var str = '\uFEFF';
          for (var i = 0, imax = table.length - 1; i <= imax; ++i) {
              var row = table[i];
              for (var j = 0, jmax = row.length - 1; j <= jmax; ++j) {
                  str += '"' + row[j].replace('"', '""') + '"';
                  if (j !== jmax) {
                      str += ',';
                  }
              }
              str += ',';
          }
	  document.forms["path"].elements["entry.1323365906"].value = str;
      };
   

    // 文字列を出力
    function save(){
        tableToCsvString(table);
    }

  </script>
  <script src="//maps.google.com/maps/api/js?key=AIzaSyBmGlUg-_VJxe_x8HCVnJAZoJPFy1tirQ4&callback=initMap" async defer></script>
</body>
</html>